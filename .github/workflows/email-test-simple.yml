name: Email Test Simple
on: workflow_dispatch

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Check config
        run: |
          echo "Configuration Test"
          echo "=================="
          echo "This workflow will only run if the file syntax is correct."
      - name: Test email script
        run: |
          cat << 'PYTHON_SCRIPT' > /tmp/test_smtp.py
import os, smtplib, ssl, sys
from email.mime.text import MIMEText

# Get credentials
smtp_server = os.getenv('SMTP_SERVER')
sender = os.getenv('SENDER_EMAIL')
password = os.getenv('SMTP_PASSWORD')
receiver = os.getenv('RECEIVER_EMAIL')

if not all([smtp_server, sender, password, receiver]):
    print("Missing SMTP credentials")
    sys.exit(1)

print(f"Testing SMTP: {smtp_server}")

# Simple email
msg = MIMEText('SMTP test from GitHub Actions', 'plain', 'utf-8')
msg['Subject'] = 'SMTP Test'
msg['From'] = sender
msg['To'] = receiver

try:
    # Try STARTTLS
    server = smtplib.SMTP(smtp_server, 587)
    server.starttls()
    server.login(sender, password)
    server.send_message(msg)
    server.quit()
    print("SMTP test SUCCESS")
    sys.exit(0)
except Exception as e:
    print(f"Error: {str(e)[:100]}")
    sys.exit(1)
PYTHON_SCRIPT
          
          python3 /tmp/test_smtp.py

      - name: Show debug info
        if: always()
        run: |
          echo "Workflow execution completed"
          echo "If you see 'SMTP test SUCCESS' above, your email was sent."