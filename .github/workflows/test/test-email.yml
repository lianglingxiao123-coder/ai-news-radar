name: TEST Email ONLY
on:
  workflow_dispatch:
    inputs:
      debug_level:
        description: 'Debug level'
        default: 'high'
        required: false

jobs:
  direct-test:
    runs-on: ubuntu-latest
    steps:
      - name: æ˜¾ç¤ºé…ç½®ï¼ˆä¸å‘é€é‚®ä»¶ï¼‰
        env:
          SMTP_SERVER_TEST: ${{ secrets.SMTP_SERVER }}
          SENDER_EMAIL_TEST: ${{ secrets.SENDER_EMAIL }}
          RECEIVER_EMAIL_TEST: ${{ secrets.RECEIVER_EMAIL }}
        run: |
          echo "ğŸ” Secrets é…ç½®æ£€æŸ¥ (ä»…æ˜¾ç¤ºé…ç½®çŠ¶æ€ï¼Œä¸å‘é€é‚®ä»¶):"
          echo "=" * 60
          
          if [ -z "$SMTP_SERVER_TEST" ]; then
            echo "âŒ SMTP_SERVER: æœªè®¾ç½®"
          else
            echo "âœ… SMTP_SERVER: $SMTP_SERVER_TEST"
          fi
          
          if [ -z "$SENDER_EMAIL_TEST" ]; then
            echo "âŒ SENDER_EMAIL: æœªè®¾ç½®"
          else
            echo "âœ… SENDER_EMAIL: $SENDER_EMAIL_TEST"
          fi
          
          if [ -z "$RECEIVER_EMAIL_TEST" ]; then
            echo "âŒ RECEIVER_EMAIL: æœªè®¾ç½®"
          else
            echo "âœ… RECEIVER_EMAIL: $RECEIVER_EMAIL_TEST"
          fi
          
          if [ -z "${{ secrets.SMTP_PASSWORD }}" ]; then
            echo "âŒ SMTP_PASSWORD: æœªè®¾ç½®"
          else
            password_length=${#{{ secrets.SMTP_PASSWORD }}}
            echo "âœ… SMTP_PASSWORD: **** é•¿åº¦: $password_length"
          fi
          
          echo ""
          echo "ğŸ¯ ç«‹å³è§¦å‘é‚®ä»¶å‘é€çš„æ–¹æ³•ï¼š"
          echo "1. æ‰‹åŠ¨è§¦å‘åŸå§‹å·¥ä½œæµï¼šActions â†’ Daily Email Push â†’ Run workflow"
          echo "2. æˆ–ç­‰å¾…è‡ªåŠ¨è°ƒåº¦ï¼šæ˜å¤©æ—©ä¸Š7ç‚¹(åŒ—äº¬æ—¶é—´)"
          echo "3. æˆ–ä¿®æ”¹ cron ä¸ºæ›´æ—©æ—¶é—´"
      
      - name: ç›´æ¥è§¦å‘é‚®ä»¶å·¥ä½œæµ
        run: |
          echo "ğŸ”„ ç›´æ¥æ¿€æ´»é‚®ä»¶å‘é€å·¥ä½œæµ..."
          
          # ä½¿ç”¨ GitHub API è§¦å‘åŸå§‹å·¥ä½œæµ
          curl -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
            -H "Content-Type: application/json" \
            -d '{"ref":"master"}' \
            https://api.github.com/repos/${{ github.repository }}/actions/workflows/daily-email.yml/dispatches 2>&1 | grep -i "message\|status" || echo "è§¦å‘è¯·æ±‚å·²å‘é€"
          
          echo ""
          echo "ğŸ“‹ å·¥ä½œæµè§¦å‘å®Œæˆï¼Œè¯·æ£€æŸ¥ Actions é¡µé¢"
          echo "é“¾æ¥: https://github.com/${{ github.repository }}/actions"
      
      - name: æ£€æŸ¥å·¥ä½œæµçŠ¶æ€
        run: |
          echo "â° ç­‰å¾…å·¥ä½œæµå¼€å§‹..."
          sleep 10
          
          echo ""
          echo "ğŸ”— è¯·ç«‹å³è®¿é—®: https://github.com/${{ github.repository }}/actions"
          echo "æŸ¥çœ‹ 'Daily Email Push' å·¥ä½œæµçš„çŠ¶æ€"