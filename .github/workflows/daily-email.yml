- name: Send daily notification
        env:
          SMTP_SERVER: ${{ secrets.SMTP_SERVER }}
          SMTP_PASSWORD: ${{ secrets.SMTP_PASSWORD }}
          SENDER_EMAIL: ${{ secrets.SENDER_EMAIL }}
          RECEIVER_EMAIL: ${{ secrets.RECEIVER_EMAIL }}
        run: |
          echo "AI News Radar Daily Notification"
          echo "=================================="
          echo "æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S') UTC"
          echo "åŒ—äº¬æ—¶é—´: $(TZ='Asia/Shanghai' date '+%Y-%m-%d %H:%M:%S')"

          python3 << 'EOF'
          import os, smtplib, datetime
          from email.mime.text import MIMEText

          # è·å–é…ç½®
          SMTP_SERVER = os.getenv('SMTP_SERVER', '')
          SMTP_PASSWORD = os.getenv('SMTP_PASSWORD', '')
          SENDER_EMAIL = os.getenv('SENDER_EMAIL', '')
          RECEIVER_EMAIL = os.getenv('RECEIVER_EMAIL', '')

          print(f'âœ” SMTPæœåŠ¡å™¨: {SMTP_SERVER}')
          print(f'âœ” å‘ä»¶é‚®ç®±: {SENDER_EMAIL}')

          if not all([SMTP_SERVER, SMTP_PASSWORD, SENDER_EMAIL, RECEIVER_EMAIL]):
              print('âš  ç¼ºå¤±å¿…è¦é…ç½®')
              exit(1)

          # æ„å»ºé‚®ä»¶å†…å®¹
          today = datetime.datetime.now().strftime("%Y-%m-%d")
          today_cn = datetime.datetime.now().astimezone(
              datetime.timezone(datetime.timedelta(hours=8))
          ).strftime("%Y-%m-%d %H:%M:%S")

          subject = f"AIæ–°é—»é›·è¾¾æ—¥æŠ¥ - {today}"
          body = f"""AIæ–°é—»é›·è¾¾æ—¥æŠ¥
          =============

          ğŸ“… æ—¥æœŸï¼š{today}
          ğŸ•’ åŒ—äº¬æ—¶é—´ï¼š{today_cn}

          ğŸ¯ ç³»ç»ŸçŠ¶æ€é€šçŸ¥
          æ‚¨çš„AIæ–°é—»é›·è¾¾ç³»ç»Ÿæ­£å¸¸è¿è¡Œã€‚

          ğŸ’¡ ä»Šæ—¥æ¦‚å†µï¼š
          â€¢ é‚®ä»¶æ¨é€æœåŠ¡ï¼šåœ¨çº¿ âœ“
          â€¢ è‡ªåŠ¨è°ƒåº¦ç³»ç»Ÿï¼šå¯ç”¨ âœ“
          â€¢ SMTPé‚®ä»¶æœåŠ¡ï¼šæ­£å¸¸ âœ“
          â€¢ ä¸‹ä¸€æ¬¡æ¨é€ï¼šæ˜æ—¥07:30

          ğŸ“Š è¿è¡Œç»Ÿè®¡ï¼š
          â€¢ æˆåŠŸç‡ï¼šæ­£å¸¸
          â€¢ è‡ªåŠ¨è°ƒåº¦ï¼šè¿è¡Œä¸­

          æ„Ÿè°¢ä½¿ç”¨AIæ–°é—»é›·è¾¾æœåŠ¡ï¼

          --
          AI News Radar è‡ªåŠ¨ç³»ç»Ÿ
          """

          try:
              msg = MIMEText(body, 'plain', 'utf-8')
              msg['Subject'] = subject
              msg['From'] = f'AIæ–°é—»é›·è¾¾ <{SENDER_EMAIL}>'
              msg['To'] = RECEIVER_EMAIL

              print(f'ğŸ“§ æ­£åœ¨å‘é€é‚®ä»¶è‡³: {RECEIVER_EMAIL}')

              # ä½¿ç”¨ 587 ç«¯å£é… STARTTLS æ˜¯æ ‡å‡†åšæ³•
              server = smtplib.SMTP(SMTP_SERVER, 587, timeout=15)
              server.starttls()
              server.login(SENDER_EMAIL, SMTP_PASSWORD)
              server.send_message(msg)
              server.quit()

              print('ğŸ‰ æ—¥æŠ¥é‚®ä»¶å‘é€æˆåŠŸï¼')
          except Exception as e:
              print(f'âŒ å‘é€å¤±è´¥: {str(e)}')
              exit(1)
          EOF
          
          echo "âœ… æµç¨‹æ‰§è¡Œå®Œæˆ"
