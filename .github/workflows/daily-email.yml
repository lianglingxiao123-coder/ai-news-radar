name: AI News Daily Notification
on:
  workflow_dispatch:
  schedule:
    - cron: '30 23 * * *' # åŒ—äº¬æ—¶é—´ 07:30

jobs:
  send-notification:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Send daily notification
        env:
          SMTP_SERVER: ${{ secrets.SMTP_SERVER }}
          SMTP_PASSWORD: ${{ secrets.SMTP_PASSWORD }}
          SENDER_EMAIL: ${{ secrets.SENDER_EMAIL }}
          RECEIVER_EMAIL: ${{ secrets.RECEIVER_EMAIL }}
        run: |
          python3 << 'EOF'
          import os, smtplib, datetime
          from email.mime.text import MIMEText

          # 1. è·å–ç¯å¢ƒå˜é‡
          SMTP_SERVER = os.getenv('SMTP_SERVER', '')
          SMTP_PASSWORD = os.getenv('SMTP_PASSWORD', '')
          SENDER_EMAIL = os.getenv('SENDER_EMAIL', '')
          RECEIVER_EMAIL = os.getenv('RECEIVER_EMAIL', '')

          if not all([SMTP_SERVER, SMTP_PASSWORD, SENDER_EMAIL, RECEIVER_EMAIL]):
              print("âŒ ç¼ºå¤± Secrets é…ç½®ï¼Œè¯·åœ¨ Settings -> Secrets ä¸­æ£€æŸ¥")
              exit(1)

          # 2. æ„å»ºé‚®ä»¶æ­£æ–‡
          today = datetime.datetime.now().strftime("%Y-%m-%d")
          body = f"""AIæ–°é—»é›·è¾¾æ—¥æŠ¥
          =============
          ğŸ“… æ—¥æœŸï¼š{today}
          ğŸ¯ ç³»ç»ŸçŠ¶æ€ï¼šæ­£å¸¸è¿è¡Œä¸­
          
          æç¤ºï¼šè¿™æ˜¯ä¸€æ¡è‡ªåŠ¨ç”Ÿæˆçš„ç³»ç»ŸçŠ¶æ€é€šçŸ¥ã€‚
          """

          # 3. å‘é€é‚®ä»¶
          try:
              msg = MIMEText(body, 'plain', 'utf-8')
              msg['Subject'] = f"AIæ–°é—»é›·è¾¾æ—¥æŠ¥ - {today}"
              msg['From'] = f"AI News Radar <{SENDER_EMAIL}>"
              msg['To'] = RECEIVER_EMAIL

              server = smtplib.SMTP(SMTP_SERVER, 587, timeout=15)
              server.starttls()
              server.login(SENDER_EMAIL, SMTP_PASSWORD)
              server.send_message(msg)
              server.quit()
              print("âœ… é‚®ä»¶å‘é€æˆåŠŸï¼")
          except Exception as e:
              print(f"âŒ å‘é€å¤±è´¥: {e}")
              exit(1)
          EOF
