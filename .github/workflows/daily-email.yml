name: Daily AI News Email
on:
  workflow_dispatch:
  schedule:
    - cron: '30 23 * * *'
jobs:
  send-email:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    - name: Send test email
      env:
        SMTP_SERVER: ${{ secrets.SMTP_SERVER }}
        SMTP_PASSWORD: ${{ secrets.SMTP_PASSWORD }}
        SENDER_EMAIL: ${{ secrets.SENDER_EMAIL }}
        RECEIVER_EMAIL: ${{ secrets.RECEIVER_EMAIL }}
      run: |
        echo "Testing SMTP configuration..."
        # 正确的base64编码Python代码，包含MIMEText正确导入
        python_code="aW1wb3J0IG9zLCBzbXRwbGliLCBzeXMKZnJvbSBlbWFpbC5taW1lLnRleHQgaW1wb3J0IE1JTUVUZXh0CgpzZXJ2ZXIgPSBvcy5lbnZpcm9uLmdldCgnU01UUF9TRVJWRVInKQpzZW5kZXIgPSBvcy5lbnZpcm9uLmdldCgnU0VOREVSX0VNQUlMJykKcGFzc3dvcmQgPSBvcy5lbnZpcm9uLmdldCgnU01UUF9QQVNTV09SRCcpCnJlY2VpdmVyID0gb3MuZW52aXJvbi5nZXQoJ1JFQ0VJVkVSX0VNQUlMJykKCnByaW50KCdDT05GSUc6JykKcHJpbnQoZidTZXJ2ZXI6IHtzZXJ2ZXJ9JykKcHJpbnQoZidTZW5kZXI6IHtzZW5kZXJ9JykKcHJpbnQoZidSZWNlaXZlcjoge3JlY2VpdmVyfScpCgppZiBub3QgYWxsKFtzZXJ2ZXIsIHNlbmRlciwgcGFzc3dvcmQsIHJlY2VpdmVyXSk6CiAgICBwcmludCgnTWlzc2luZyBjb25maWcoKScpCiAgICBzeXMuZXhpdCgwKQoKbXNnID0gTUlNRVRleHQoJ0FJIE5ld3MgUmFkYXIgdGVzdCBtYWlsJywgJ3BsYWluJywgJ3V0Zi04JykKbXNnLkRlY29kZWRfY29udGVudCA9IG1zZy5nZXRfcGF5bG9hZCgpCm1zZ1snU3ViamVjdCddID0gJ0FJIE5ld3MgUmFkYXIgVGVzdCcKbXNnWydGcm9tJ10gPSBzZW5kZXIKbXNnWydUbyddID0gcmVjZWl2ZXIKCnRyeToKICAgIHMgPSBzbXRwbGliLlNNVFAoc2VydmVyLCA1ODcpCiAgICBzLnN0YXJ0dGxzKCkKICAgIHMubG9naW4oc2VuZGVyLCBwYXNzd29yZCkKICAgIHMuc2VuZF9tZXNzYWdlKG1zZykKICAgIHMucXVpdCgpCiAgICBwcmludCgnRW1haWwgc2VudCBTVUNDRVNTIScpCiAgICBzeXMuZXhpdCgwKQpleGNlcHQgQmFzZUV4Y2VwdGlvbiBhcyBlOgogICAgcHJpbnQoZidFUlJPUjoge3N0cihlKVs6ODBdfScpCiAgICBzeXMuZXhpdCgxKQ=="
        python3 -c "$(echo "$python_code" | base64 -d)"