name: Daily AI News Email
on:
  workflow_dispatch:
  schedule:
    - cron: '30 23 * * *'
jobs:
  send-email:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    - name: Send test email
      env:
        SMTP_SERVER: ${{ secrets.SMTP_SERVER }}
        SMTP_PASSWORD: ${{ secrets.SMTP_PASSWORD }}
        SENDER_EMAIL: ${{ secrets.SENDER_EMAIL }}
        RECEIVER_EMAIL: ${{ secrets.RECEIVER_EMAIL }}
      run: |
        echo "Testing SMTP configuration..."
        # 正确的base64编码Python代码
        python_code="aW1wb3J0IG9zLCBzbXRwbGliLCBzeXMKZnJvbSBlbWFpbC5taW1lLnRleHQgaW1wb3J0IE1pbWVUZXh0CgpzZXJ2ZXIgPSBvcy5lbnZpcm9uLmdldCgnU01UUF9TRVJWRVInKQpzZW5kZXIgPSBvcy5lbnZpcm9uLmdldCgnU0VOREVSX0VNQUlMJykKcGFzc3dvcmQgPSBvcy5lbnZpcm9uLmdldCgnU01UUF9QQVNTV09SRCcpCnJlY2VpdmVyID0gb3MuZW52aXJvbi5nZXQoJ1JFQ0VJVkVSX0VNQUlMJykKCnByaW50KCdDT05GSUc6JykKcHJpbnQoZiJTZXJ2ZXI6IHtzZXJ2ZXJ9IikKcHJpbnQoZiJTZW5kZXI6IHtzZW5kZXJ9IikKcHJpbnQoZiJSZWNlaXZlcjoge3JlY2VpdmVyfSIpCgppZiBub3QgYWxsKFtzZXJ2ZXIsIHNlbmRlciwgcGFzc3dvcmQsIHJlY2VpdmVyXSk6CiAgICBwcmludCgnTWlzc2luZyBjb25maWcoKScpCiAgICBzeXMuZXhpdCgwKQoKbXNnID0gTWltZVRleHQoJ0FJIE5ld3MgUmFkYXIgdGVzdCBtYWlsJywgJ3BsYWluJywgJ3V0Zi04JykKbXNnLkRlY29kZXNoZWRfY29udGVudCA9IG1zZy5nZXRfcGF5bG9kKCkKbXNnWydTdWJqZWN0J10gPSAnQUkgTmV3cyBSYWRhciBUZXN0Jwptc2dbJ0Zyb20nXSA9IHNlbmRlcgptc2dbJ1RvJ10gPSByZWNlaXZlcgoKdHJ5OgogICAgcyA9IHNtdHBsaWIuU01UUChzZXJ2ZXIsIDU4NykKICAgIHMuc3RhcnR0bHMoKQogICAgcy5sb2dpbihzZW5kZXIsIHBhc3N3b3JkKQogICAgcy5zZW5kX21lc3NhZ2UobXNnKQogICAgcy5xdWl0KCkKICAgIHByaW50KCdFbWFpbCBzZW50IFNVQ0NFU1MhJykKICAgIHN5cy5leGl0KDApCmV4Y2VwdCBCYXNlRXhjZXB0aW9uIGFzIGU6CiAgICBwcmludChmJ0VSUk9SOiB7c3RyKGUpWzo4MF19JykKICAgIHN5cy5leGl0KDEpCg=="
        python3 -c "$(echo "$python_code" | base64 -d)"