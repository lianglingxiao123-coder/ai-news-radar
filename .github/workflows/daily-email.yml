name: Daily Email Push
on:
  workflow_dispatch:
  schedule:
    - cron: '30 23 * * *'

jobs:
  send-email:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          
      - name: Install packages
        run: pip install requests feedparser
        
      - name: Create email script
        run: |
          cat > /tmp/send_test.py << 'PYEOF'
import os, smtplib, sys
from email.mime.text import MIMEText

def send_test():
    smtp_server = os.environ.get('SMTP_SERVER')
    sender = os.environ.get('SENDER_EMAIL')
    password = os.environ.get('SMTP_PASSWORD')
    receiver = os.environ.get('RECEIVER_EMAIL')
    
    print("ğŸ“§ Email Configuration Test")
    print(f"  Server: {smtp_server}")
    print(f"  From: {sender}")
    print(f"  To: {receiver}")
    
    if not all([smtp_server, sender, password, receiver]):
        print("âŒ Missing configuration")
        return False
    
    # Create email
    msg = MIMEText("æµ‹è¯•é‚®ä»¶ï¼šä½ çš„AIæ–°é—»é›·è¾¾æ¯æ—¥æ¨é€ç³»ç»Ÿå·²ä¿®å¤ã€‚æ˜æ—¥å¼€å§‹7:30è‡ªåŠ¨æ¨é€åŒ…å«Twitter/YouTube/RSSçš„AIæ–°é—»ã€‚", 'plain', 'utf-8')
    msg['Subject'] = 'âœ… AIæ–°é—»é›·è¾¾ï¼šç³»ç»Ÿä¿®å¤éªŒè¯'
    msg['From'] = sender
    msg['To'] = receiver
    
    try:
        # Try port 587
        server = smtplib.SMTP(smtp_server, 587)
        server.starttls()
        server.login(sender, password)
        server.send_message(msg)
        server.quit()
        print("âœ… Email sent successfully!")
        return True
    except Exception as e:
        print(f"âŒ SMTP error: {str(e)[:100]}")
        return False

if __name__ == "__main__":
    success = send_test()
    sys.exit(0 if success else 1)
PYEOF
          
      - name: Run email test
        env:
          SMTP_SERVER: ${{ secrets.SMTP_SERVER }}
          SMTP_PASSWORD: ${{ secrets.SMTP_PASSWORD }}
          SENDER_EMAIL: ${{ secrets.SENDER_EMAIL }}
          RECEIVER_EMAIL: ${{ secrets.RECEIVER_EMAIL }}
        run: python /tmp/send_test.py
      
      - name: Report
        if: always()
        run: |
          echo "========================================"
          echo "AIæ–°é—»é›·è¾¾ - é‚®ç®±ç³»ç»Ÿæµ‹è¯•æŠ¥å‘Š"
          echo "========================================"
          echo "æ—¶é—´: $(date)"
          echo "ç»“æœ: $( [ $? -eq 0 ] && echo 'âœ… æˆåŠŸ' || echo 'âŒ å¤±è´¥' )"
          echo ""
          echo "å¦‚æœçœ‹åˆ°'Email sent successfully'ï¼Œè¯·åœ¨é‚®ç®±ä¸­ç¡®è®¤ã€‚"
          echo "ğŸ“… ç³»ç»Ÿå°†ä»æ˜æ—¥èµ·æ¯æ—¥7:30è‡ªåŠ¨æ¨é€ã€‚"